# Daily Discover 前端统一开发规范 v3.0

## 0. 文档引言

本文档是 "Daily Discover" 前端项目的**唯一官方开发规范**。旨在为所有开发者（包括人类与AI）提供一套清晰、统一、可执行的指导原则，以支撑项目在**高并发、高性能、高可用、高可扩展**背景下的快速、高质量迭代。

**所有开发活动，无论是功能实现、代码重构还是AI辅助编程，都必须严格遵守本规范。**

---

## 1. 核心设计原则与目标

- **MVP原则 (Minimum Viable Product)**: 始终聚焦核心业务闭环，优先交付最大化价值的功能，快速验证市场反馈。
- **大厂标准**: 参考阿里、腾讯、字节跳动等一线互联网公司的最佳实践，构建企业级前端应用。
- **四高目标**:
    - **高并发**: 优化请求管理与数据缓存，支撑千万级DAU。
    - **高性能**: 极致的加载与渲染优化，首屏时间 < 1.5s。
    - **高可用**: 完善的错误处理、降级方案与监控告警，确保系统稳定性。
    - **高可扩展**: 采用微前端思想与插件化设计，适应未来业务的快速扩张。
- **逻辑与视图分离**: 这是我们架构的核心哲学，所有组件必须将UI（视图）与业务逻辑（Hooks）彻底分离，以提升复用性和可维护性。
- **AI驱动开发**: 本规范为AI高效、自主地进行开发提供清晰的指令集，最大化自动化程度。

---

## 2. 应用架构设计

### 2.1 总体架构

我们采用**"分层架构 + 微前端思想"**，确保系统的扩展性、可维护性和团队协作效率。

```
+--------------------------------------------+
|                 应用层                      |  (业务页面, 微前端应用)
+--------------------------------------------+
|                 业务层                      |  (业务组件, 业务逻辑Hooks)
+-------------+---------------+--------------+
|    UI层      |    逻辑层     |     数据层     |
| (Atomic组件) | (React Hooks) | (Redux/API)  |
+-------------+---------------+--------------+
|                 基础层                      |  (工具库, 统一服务)
+--------------------------------------------+
```

### 2.2 核心技术栈

- **UI框架**: React 18（并行渲染 + Suspense）
- **状态管理**: Redux Toolkit + RTK Query（统一状态管理与数据获取）
- **UI组件体系**: 自研主题系统，严格遵循原子设计（Atomic Design）
- **样式方案**: styled-components + Design Tokens
- **路由**: React Router v6
- **HTTP客户端**: Axios
- **构建工具**: Webpack 5 + Babel
- **监控体系**: Sentry（错误）+ Web Vitals（性能）
- **后端交互**: 基于RESTful API调用`daily-discover-server` SpringBoot服务

### 2.3 高性能、高可用、高扩展性设计

1.  **性能优化 (Performance)**
    - **加载**: 实施资源分级加载、代码分割（路由级、组件级、库级）、预加载与预连接。
    - **渲染**: 全面使用`React.memo`, `useMemo`, `useCallback`，长列表必须使用虚拟列表（`react-window`），复杂计算使用Web Workers。
    - **资源**: 图片使用WebP/AVIF格式，并实现懒加载和响应式加载。

2.  **可用性 (Availability)**
    - **错误处理**: 全局设置Error Boundary，组件级实现UI降级。
    - **状态恢复**: 实现会话恢复、表单保护和关键操作的智能重试。
    - **离线支持**: 关键页面（如核心浏览页）支持Service Worker离线访问。

3.  **扩展性 (Scalability)**
    - **微前端架构**: 核心模块设计为独立子应用，为未来运行时集成做好准备。
    - **插件化设计**: 非核心功能（如特定活动、小游戏）设计为可动态加载的插件。

### 2.4 安全与交互规范

1.  **安全防护**:
    - **数据安全**: 敏感信息（支付、个人隐私）前后端双重加密，前端展示必须脱敏。
    - **攻击防护**: 严格执行内容安全策略(CSP)，防御XSS；通过Token校验，防御CSRF和点击劫持。
    - **业务安全**: 对高频操作进行前端限流，并配合后端进行风险控制。
2.  **前后端交互**:
    - **API**: 遵循RESTful风格，路径包含版本号（如`/api/v1/`），使用Swagger管理文档。
    - **数据格式**: 请求体与响应体遵循统一结构（`{code, message, data, trace}`）。
    - **调用策略**: 核心接口实现自动重试和熔断降级；建立多级缓存（内存、localStorage）。

---

## 3. 目录结构与文件命名规范

### 3.1 `src` 目录结构 (唯一标准)
```
src/
├── assets/               # 静态资源 (图片、字体、全局样式)
├── components/           # 全局业务组件 (多个页面复用，但不属于theme)
├── constants/            # 全局常量 (API路径、业务常量)
├── hooks/                # 全局业务Hooks (如 useAuth, useCart)
├── pages/                # 页面级组件 (一个文件代表一个页面)
├── routes/               # 路由配置
├── services/             # 数据服务层
│   ├── http/             # HTTP基础服务 (Axios实例, 拦截器, 缓存)
│   └── api/              # API模块 (按业务拆分)
├── store/                # 全局状态管理 (Redux)
├── theme/                # 主题与UI组件系统 (原子设计)
│   ├── components/       # UI基础组件 (atoms, molecules, etc.)
│   ├── hooks/            # UI组件专用逻辑Hooks (如 useToast)
│   ├── providers/        # 主题/全局上下文提供者
│   ├── styles/           # 样式工具与常量
│   └── tokens.js         # 设计令牌
├── utils/                # 通用工具函数
├── App.js                # 应用根组件
└── index.js              # 应用渲染入口
```

### 3.2 文件命名规范

- **组件 (Pages, Components, Theme)**: **PascalCase** (`ProductDetail.js`, `BasePage.js`, `Button.js`)。
- **Hooks**: **camelCase**，以`use`开头 (`useAuth.js`, `useToast.js`)。
- **其他 (utils, services, constants)**: **camelCase** (`format.js`, `userService.js`)。
- **样式文件**: 与关联的组件同名 (`ProductDetail.css`)。

---

## 4. UI开发体系 (原子设计)

项目的UI开发体系是整个前端工程的基石，它确保了视觉统一性、组件复用性和开发效率。我们所有的UI界面都必须通过`src/theme/`下的原子设计系统来构建。

**关于UI组件的具体实现、原子设计分层细节、组件API、以及针对AI的UI开发核心规范，请参阅以下专门的文档：**

- ### **[主题设计系统架构与AI开发规范](./theme-design-system.md)**

该文档是UI开发的**"唯一真实来源"**，详细定义了从`原子`到`模板`的各层级组件规范。

---

## 5. AI & 开发者核心开发规则

**此为最高优先级规则，所有代码提交前必须自查。**

1.  **【目录规则】严格遵守目录规范**
    - 创建任何文件前，必须先查阅`3.1 src 目录结构`，并将其放置在正确的位置。
    - 页面级组件放`pages`，可复用业务组件放`components`，UI基础组件放`theme/components`。

2.  **【架构规则】逻辑与视图分离 (Hook First)**
    - 任何有状态、有副作用或包含复杂逻辑的组件，**必须**将逻辑抽离到对应的`useComponent` Hook中。
    - **严禁**在JSX文件中编写大量业务逻辑。

3.  **【UI规则】遵循原子设计**
    - **严禁**在`pages`或`components`中直接编写本应属于`theme`层的UI组件。
    - 构建界面时，优先从`theme/components`中组合使用`atoms`和`molecules`。

4.  **【样式规则】使用设计令牌 (No Hard-coded Styles)**
    - **严禁**在组件中硬编码任何颜色、间距、字号等值。
    - **必须**使用`src/theme/tokens.js`中定义的令牌。

5.  **【性能规则】性能默认，懒载先行**
    - 所有`pages`组件和`organisms`级别的组件，**必须**默认使用`React.lazy`和`Suspense`进行懒加载。
    - 渲染超过10个项目的列表时，**必须**使用虚拟化技术 (`react-window`)。

6.  **【API规则】调用服务层**
    - **严禁**在组件或页面中直接调用`axios`。
    - **必须**通过`src/services/api/`中定义的函数来获取数据。

7.  **【质量规则】文档与测试同行**
    - 创建新组件时，**必须**为其编写JSDoc注释，说明其用途和Props。
    - 核心业务逻辑和工具函数**必须**编写单元测试。

---

## 6. 工程与流程规范

1.  **版本控制**
    - **分支模型**: 遵循 Git Flow。`feat/xxx`开发功能, `fix/xxx`修复bug。
    - **提交信息**: 遵循Conventional Commits规范 (`feat:`, `fix:`, `refactor:`, `docs:`等)。一次提交只做一件事。

2.  **代码质量**
    - **静态检查**: 所有代码提交前必须通过ESLint和Prettier检查。
    - **Code Review**: 所有向`main`分支合并的PR**必须**经过至少一位其他成员的审查。

3.  **持续集成/持续部署 (CI/CD)**
    - 每次提交自动运行Lint检查和单元测试。
    - 合并到`main`分支后，自动构建并部署到测试环境。
    - 发布生产环境需要手动触发，并采用灰度发布策略。

---

## 7. 当前问题与重构指引

当前项目代码库存在部分历史代码不符合本规范。

- **重构原则**: 遵循"童子军军规"——**在修改或使用旧代码时，顺手将其重构至符合新规范**。
- **重构计划**: 具体的存量代码重构任务请参考 `docs/archive/` 目录下的历史重构计划。
- **新代码**: 所有新代码**必须100%**遵守本规范，不允许产生新的技术债。 