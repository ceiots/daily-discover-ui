# 2. 应用架构与技术栈

## 2.1 总体架构

我们采用**"分层架构 + 微前端思想"**，确保系统的扩展性、可维护性和团队协作效率。

```
+--------------------------------------------+
|                 应用层                      |  (业务页面, 微前端应用)
+--------------------------------------------+
|                 业务层                      |  (业务组件, 业务逻辑Hooks)
+-------------+---------------+--------------+
|    UI层      |    逻辑层     |     数据层     |
| (Atomic组件) | (React Hooks) | (Redux/API)  |
+-------------+---------------+--------------+
|                 基础层                      |  (工具库, 统一服务)
+--------------------------------------------+
```

## 2.2 核心技术栈

- **UI框架**: React 18（并行渲染 + Suspense）
- **状态管理**: Redux Toolkit + RTK Query（统一状态管理与数据获取）
- **UI组件体系**: 自研主题系统，严格遵循原子设计（Atomic Design）。详见 **[04_UI_DESIGN_SYSTEM.md](./04_UI_DESIGN_SYSTEM.md)**
- **样式方案**: styled-components + Design Tokens
- **路由**: React Router v6
- **HTTP客户端**: Axios
- **构建工具**: Webpack 5 + Babel
- **监控体系**: Sentry（错误）+ Web Vitals（性能）
- **后端交互**: 基于RESTful API调用 `daily-discover-server` SpringBoot服务。

## 2.3 高性能、高可用、高扩展性设计

1.  **性能优化 (Performance)**
    - **加载**: 实施资源分级加载、代码分割（路由级、组件级、库级）、预加载与预连接。
    - **渲染**: 全面使用`React.memo`, `useMemo`, `useCallback`，长列表必须使用虚拟列表（`react-window`），复杂计算使用Web Workers。
    - **资源**: 图片使用WebP/AVIF格式，并实现懒加载和响应式加载。

2.  **可用性 (Availability)**
    - **错误处理**: 全局设置Error Boundary，组件级实现UI降级。
    - **状态恢复**: 实现会话恢复、表单保护和关键操作的智能重试。
    - **离线支持**: 关键页面（如核心浏览页）支持Service Worker离线访问。

3.  **扩展性 (Scalability)**
    - **微前端架构**: 核心模块设计为独立子应用，为未来运行时集成做好准备。
    - **插件化设计**: 非核心功能（如特定活动、小游戏）设计为可动态加载的插件。

## 2.4 安全与交互规范

1.  **安全防护**:
    - **数据安全**: 敏感信息（支付、个人隐私）前后端双重加密，前端展示必须脱敏。
    - **攻击防护**: 严格执行内容安全策略(CSP)，防御XSS；通过Token校验，防御CSRF和点击劫持。
    - **业务安全**: 对高频操作进行前端限流，并配合后端进行风险控制。
2.  **前后端交互**:
    - **API**: 遵循RESTful风格，路径包含版本号（如`/api/v1/`），使用Swagger管理文档。
    - **数据格式**: 请求体与响应体遵循统一结构（`{code, message, data, trace}`）。
    - **调用策略**: 核心接口实现自动重试和熔断降级；建立多级缓存（内存、localStorage）。 